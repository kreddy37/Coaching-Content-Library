# Story 2.2: DrillCard Component

Status: done

<!-- Generated by SM Agent (Bob) with exhaustive context analysis from Epic 2, Story 2.1, Architecture, and UX Design Spec -->

## Story

As a coach,
I want to see visual drill cards with thumbnails and key information,
So that I can quickly scan and identify drills at a glance.

## Acceptance Criteria

**Given** the DrillCard component
**When** I create src/components/drills/DrillCard.tsx
**Then** Component accepts ContentItem as prop
**And** Component uses shadcn/ui Card primitive
**And** Card has hover effect (slight elevation/scale)
**And** Card is clickable (future: opens drill detail)

**Given** thumbnail display
**When** drill has thumbnail_url (YouTube, Reddit)
**Then** <img> element displays thumbnail
**And** Image has alt text with drill title
**And** Image uses object-cover for consistent aspect ratio
**And** Image has loading="lazy" for progressive loading (NFR5)
**And** Aspect ratio is 16:9 for video thumbnails

**Given** Instagram source without thumbnail
**When** source is Instagram
**Then** Placeholder displays with:
  - Pink/purple gradient background (from pink-400 to purple-500)
  - Instagram icon (Lucide Instagram) centered in white
  - Same 16:9 aspect ratio as thumbnails

**Given** TikTok source without thumbnail
**When** source is TikTok
**Then** Placeholder displays with:
  - Black background (#000000)
  - Cyan TikTok-style musical note icon centered
  - Same 16:9 aspect ratio as thumbnails

**Given** card metadata display
**When** card renders
**Then** Following are visible below thumbnail:
  - Drill title (truncated to 2 lines with ellipsis)
  - Author name (if available, truncated to 1 line)
  - SourceBadge component showing source (Story 2.4)
  - DifficultyBadge component if difficulty exists (Story 2.4)
  - 1-2 drill_tags displayed as small chips (progressive disclosure)

**Given** card layout
**When** content is displayed
**Then** Layout follows UX spec:
  - Thumbnail at top (thumbnail-first visual hierarchy)
  - Title in hockey-blue color, bold, 16px font
  - Author in gray-600, 14px font
  - Badges and tags in flex row with gap-2
  - Proper padding (p-4) and spacing between elements

## Tasks / Subtasks

- [x] **Task 1: Create DrillCard Component Structure (AC: #1)**
  - [x] 1.1: Create `src/components/drills/__tests__/DrillCard.test.tsx` with failing tests
  - [x] 1.2: Create `src/components/drills/DrillCard.tsx` file
  - [x] 1.3: Export DrillCardProps interface separately (CRITICAL: project-context.md pattern)
  - [x] 1.4: Import ContentItem type from '@/lib/types'
  - [x] 1.5: Import Card components from '@/components/ui/card'
  - [x] 1.6: Set up component structure with shadcn/ui Card primitive
  - [x] 1.7: Add onClick handler prop for clickable card

- [x] **Task 2: Implement Thumbnail Display Logic (AC: #2)**
  - [x] 2.1: Write failing test for thumbnail display with different sources
  - [x] 2.2: Conditional rendering: Check if drill.thumbnail_url exists
  - [x] 2.3: If thumbnail exists: render <img> with src={drill.thumbnail_url}
  - [x] 2.4: Add alt text: alt={drill.title || 'Drill thumbnail'}
  - [x] 2.5: Apply Tailwind classes: object-cover, aspect-video (16:9), w-full
  - [x] 2.6: Add loading="lazy" attribute for progressive loading (NFR5)
  - [x] 2.7: Add rounded-t-lg for top corners matching card border radius

- [x] **Task 3: Implement Instagram Placeholder (AC: #3)**
  - [x] 3.1: Write failing test for Instagram source without thumbnail
  - [x] 3.2: Check if source === 'Instagram' && !thumbnail_url
  - [x] 3.3: Render div with gradient: bg-gradient-to-br from-pink-400 to-purple-500
  - [x] 3.4: Import Instagram icon from Lucide React
  - [x] 3.5: Center icon with flex items-center justify-center
  - [x] 3.6: Icon color white, size 48 (large for visibility)
  - [x] 3.7: Maintain aspect-video (16:9) ratio matching real thumbnails
  - [x] 3.8: Apply rounded-t-lg for consistency

- [x] **Task 4: Implement TikTok Placeholder (AC: #4)**
  - [x] 4.1: Write failing test for TikTok source without thumbnail
  - [x] 4.2: Check if source === 'TikTok' && !thumbnail_url
  - [x] 4.3: Render div with bg-black (#000000)
  - [x] 4.4: Import Music icon from Lucide React (TikTok-style musical note)
  - [x] 4.5: Center icon with flex items-center justify-center
  - [x] 4.6: Icon color cyan-400 (TikTok brand color), size 48
  - [x] 4.7: Maintain aspect-video (16:9) ratio
  - [x] 4.8: Apply rounded-t-lg for consistency

- [x] **Task 5: Implement Card Metadata Display (AC: #5)**
  - [x] 5.1: Write failing tests for metadata rendering
  - [x] 5.2: Create CardContent wrapper below thumbnail with p-4 padding
  - [x] 5.3: Render drill title: text-hockey-blue font-semibold text-base (16px)
  - [x] 5.4: Apply line-clamp-2 for 2-line truncation with ellipsis
  - [x] 5.5: Render author if exists: text-gray-600 text-sm (14px), truncate to 1 line
  - [x] 5.6: Create placeholder SourceBadge component (Story 2.4 dependency)
  - [x] 5.7: Create placeholder DifficultyBadge component if drill.difficulty exists
  - [x] 5.8: Render 1-2 drill_tags as Badge components (progressive disclosure)
  - [x] 5.9: Use flex flex-wrap gap-2 for badges and tags row

- [x] **Task 6: Implement Hover Effects and Interactivity (AC: #1, #6)**
  - [x] 6.1: Write failing test for hover state styles
  - [x] 6.2: Add transition-all duration-250 for smooth animations
  - [x] 6.3: Add hover:scale-[1.02] for slight scale increase
  - [x] 6.4: Add hover:shadow-lg for elevation effect
  - [x] 6.5: Add border-hockey-blue-200 default, hover:border-ice-blue-400
  - [x] 6.6: Apply cursor-pointer to indicate clickability
  - [x] 6.7: Wire onClick handler to Card component

- [x] **Task 7: Create Placeholder Badge Components (AC: #5)**
  - [x] 7.1: Create src/components/drills/SourceBadge.tsx placeholder
  - [x] 7.2: Export SourceBadgeProps interface (source: ContentSource)
  - [x] 7.3: Render simple Badge with source text (YouTube, Reddit, Instagram, TikTok)
  - [x] 7.4: Apply source-specific colors temporarily (Story 2.4 will enhance)
  - [x] 7.5: Create src/components/drills/DifficultyBadge.tsx placeholder
  - [x] 7.6: Export DifficultyBadgeProps interface (difficulty: string | null)
  - [x] 7.7: Render Badge with difficulty text if provided
  - [x] 7.8: Apply basic color-coding: beginner green, intermediate amber, advanced red

- [x] **Task 8: Integration Testing and Verification (AC: #1-6)**
  - [x] 8.1: Run `npm run test` - all DrillCard tests pass
  - [x] 8.2: Verify DrillCard renders in Library.tsx grid from Story 2.1
  - [x] 8.3: Test with YouTube drill (real thumbnail)
  - [x] 8.4: Test with Instagram drill (placeholder gradient)
  - [x] 8.5: Test with TikTok drill (placeholder black + cyan icon)
  - [x] 8.6: Test with Reddit drill (real thumbnail if available)
  - [x] 8.7: Verify hover effects work (scale, shadow, border color change)
  - [x] 8.8: Verify onClick handler fires when card is clicked
  - [x] 8.9: Verify title truncates to 2 lines with ellipsis
  - [x] 8.10: Verify author truncates to 1 line
  - [x] 8.11: Verify 1-2 drill_tags display correctly
  - [x] 8.12: Run `npm run build` - TypeScript strict mode clean

## Dev Notes

### CRITICAL LEARNINGS FROM STORY 2.1

**Component Props Pattern (NEW - MANDATORY):**
- ✅ **ALWAYS export props interface separately** - enables type reusability
- ✅ Pattern from project-context.md:
  ```typescript
  export interface DrillCardProps {
    drill: ContentItem;
    onClick: () => void;
    showRelevance?: boolean;
    relevanceReason?: string;
    variant?: 'standard' | 'compact';
  }

  export function DrillCard({ drill, onClick }: DrillCardProps) {
    return <Card onClick={onClick}>...</Card>;
  }
  ```
- ❌ WRONG: Inline props without exported interface

**From Story 2.1 Implementation:**
- ✅ All components use named exports only (no default exports)
- ✅ @/ path alias MANDATORY - no relative imports
- ✅ TypeScript strict mode with explicit types
- ✅ shadcn/ui Card, Badge components available and working
- ✅ Design system colors: hockey-blue (#1e3a5f), ice-blue (#38bdf8)
- ✅ Lucide React icons installed and functional
- ✅ Unit testing with Vitest + React Testing Library established
- ✅ Library page already consuming DrillCard in grid (expects component to exist)

**From Epic 1 Retrospective:**
- ✅ Story-driven development discipline - tight AC adherence prevents scope creep
- ✅ Accessibility and error handling must be explicit in AC
- ⚠️ Add explicit accessibility: aria-label for card, keyboard navigation

### Architectural Requirements (Must Follow)

**Backend Contract - ContentItem Type:**
```typescript
// From src/lib/types.ts (Story 1.4)
interface ContentItem {
  id: number;
  source: 'YouTube' | 'Reddit' | 'Instagram' | 'TikTok'; // PascalCase enums!
  content_type: 'Video' | 'Post' | 'Image';
  url: string;
  title: string | null;
  author: string | null;
  thumbnail_url: string | null; // May be null for Instagram/TikTok
  drill_description: string | null; // NOT "description"
  drill_tags: string[] | null; // NOT "tags"
  published_at: string | null;
  created_at: string;
  difficulty: 'Beginner' | 'Intermediate' | 'Advanced' | null;
}
```

**CRITICAL: Backend Enum Values are PascalCase**
- ✅ source: 'YouTube' (NOT 'youtube')
- ✅ source: 'Instagram' (NOT 'instagram')
- ✅ source: 'TikTok' (NOT 'tiktok')
- ✅ source: 'Reddit' (NOT 'reddit')

**UX Design Specification Requirements:**

**DrillCard Specifications (from ux-design-specification.md):**
- **Thumbnail:** 16:9 aspect ratio, 160px height (standard variant)
- **Source badge:** Top-right corner of thumbnail, platform-colored background, white icon
- **Title:** Max 2 lines with ellipsis, Inter Semibold 18px
- **Default state:** 1px border hockey-blue-200, no shadow
- **Hover state:** scale(1.02), shadow-lg, border ice-blue-400, transition 250ms
- **Standard variant:** 280px min-width, 160px thumbnail height
- **Compact variant:** 240px min-width, 120px thumbnail height (future enhancement)

**Component Anatomy:**
1. Thumbnail area (top, 16:9 aspect ratio)
2. Source badge (positioned top-right corner of thumbnail)
3. Title (below thumbnail, 2-line truncation)
4. Metadata row (difficulty badge + 1-2 drill_tags)
5. Optional relevance chip (for search results - future)

**Accessibility Requirements:**
- Card should have role="article" or semantic structure
- Clickable card needs keyboard navigation (Enter key)
- Images need proper alt text
- Color contrast ratios must meet WCAG AA standards

### File Structure & Imports

**Required File Creation:**
- `src/components/drills/DrillCard.tsx` ✅ NEW
- `src/components/drills/__tests__/DrillCard.test.tsx` ✅ NEW
- `src/components/drills/SourceBadge.tsx` ✅ NEW (placeholder for Story 2.4)
- `src/components/drills/DifficultyBadge.tsx` ✅ NEW (placeholder for Story 2.4)

**Import Pattern:**
```typescript
// CORRECT imports using @/ alias
import type { ContentItem } from '@/lib/types';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Instagram, Music } from 'lucide-react';

// INCORRECT - relative imports forbidden
import { ContentItem } from '../../lib/types'; // ❌
```

**Directory Structure:**
```
src/
  components/
    drills/
      DrillCard.tsx          # Main component
      SourceBadge.tsx        # Placeholder for Story 2.4
      DifficultyBadge.tsx    # Placeholder for Story 2.4
      __tests__/
        DrillCard.test.tsx   # Unit tests
    ui/
      card.tsx               # shadcn/ui primitive (already exists)
      badge.tsx              # shadcn/ui primitive (already exists)
```

### Dependencies & Integration

**Already Installed (From Story 2.1):**
- ✅ react@19.2.0
- ✅ lucide-react@0.562.0 (icons)
- ✅ shadcn/ui components: Card, Badge
- ✅ tailwindcss@4.1.18 with custom theme
- ✅ vitest@4.0.18 + @testing-library/react

**Available from Previous Stories:**
- ✅ ContentItem type from src/lib/types.ts (Story 1.4)
- ✅ Design system colors configured in Tailwind (Story 1.2)
- ✅ Card and Badge components from shadcn/ui (Story 1.2)
- ✅ Library page expecting DrillCard in grid (Story 2.1)

**Integration Point:**
```typescript
// In src/pages/Library.tsx (Story 2.1)
import { DrillCard } from '@/components/drills/DrillCard';

export function Library() {
  const { data, isLoading, isError } = useContentList();

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {data?.items.map((drill) => (
        <DrillCard
          key={drill.id}
          drill={drill}
          onClick={() => console.log('Open drill detail (Story 3.1)')}
        />
      ))}
    </div>
  );
}
```

### Testing Approach

**Unit Testing Requirements:**
- ✅ Test component renders with all props
- ✅ Test thumbnail display for YouTube/Reddit (with thumbnail_url)
- ✅ Test Instagram placeholder rendering (pink/purple gradient)
- ✅ Test TikTok placeholder rendering (black + cyan icon)
- ✅ Test title truncation (2 lines with ellipsis)
- ✅ Test author display and truncation
- ✅ Test drill_tags rendering (1-2 tags)
- ✅ Test onClick handler fires
- ✅ Test hover state classes applied
- ✅ Mock ContentItem data for each source type

**Testing Pattern:**
```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { DrillCard } from '../DrillCard';
import type { ContentItem } from '@/lib/types';

describe('DrillCard', () => {
  const mockDrill: ContentItem = {
    id: 1,
    source: 'YouTube',
    title: 'Butterfly Recovery Drill',
    thumbnail_url: 'https://example.com/thumb.jpg',
    drill_tags: ['butterfly', 'recovery'],
    // ... other fields
  };

  it('renders thumbnail when thumbnail_url exists', () => {
    render(<DrillCard drill={mockDrill} onClick={() => {}} />);
    const img = screen.getByAltText('Butterfly Recovery Drill');
    expect(img).toHaveAttribute('loading', 'lazy');
  });

  it('renders Instagram placeholder when source is Instagram and no thumbnail', () => {
    const instagramDrill = { ...mockDrill, source: 'Instagram', thumbnail_url: null };
    render(<DrillCard drill={instagramDrill} onClick={() => {}} />);
    // Verify gradient background and Instagram icon
  });

  // More tests...
});
```

**Manual Testing Steps:**
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000/library
3. Verify DrillCard components display in grid
4. Hover over cards - verify scale, shadow, and border color change
5. Click card - verify onClick fires (check console)
6. Test with different source types (YouTube, Instagram, TikTok, Reddit)
7. Verify thumbnails load lazily (use Network tab throttling)
8. Verify title truncates to 2 lines
9. Verify author truncates to 1 line
10. Verify 1-2 drill_tags display

### Thumbnail and Placeholder Implementation Details

**YouTube/Reddit (Real Thumbnails):**
- Most reliable sources for thumbnail_url
- Use <img> with loading="lazy" for performance
- Apply object-cover to maintain aspect ratio
- Handle image load errors gracefully (future enhancement: fallback placeholder)

**Instagram Placeholder:**
- No reliable thumbnail API in MVP
- Gradient background: `bg-gradient-to-br from-pink-400 to-purple-500`
- Icon: `<Instagram className="w-12 h-12 text-white" />`
- Center icon with flex: `flex items-center justify-center`

**TikTok Placeholder:**
- No thumbnail API access in MVP
- Background: `bg-black` (#000000)
- Icon: `<Music className="w-12 h-12 text-cyan-400" />` (TikTok brand color)
- Center icon with flex: `flex items-center justify-center`

**Aspect Ratio Consistency:**
- All thumbnails and placeholders: `aspect-video` (16:9)
- Ensures consistent grid layout regardless of source
- Maintains visual hierarchy: thumbnail → metadata

### Known Constraints & Future Dependencies

**Story 2.4 Dependencies (SourceBadge, DifficultyBadge):**
- Story 2.2 creates PLACEHOLDER badge components
- Placeholders render basic Badge with text and simple colors
- Story 2.4 will enhance with:
  - Source-specific brand colors and icons
  - Positioned top-right corner of thumbnail
  - Difficulty color-coding (green/amber/red) with icons

**Story 3.1 Dependency (DrillDetail):**
- DrillCard onClick handler is wired but doesn't open detail yet
- Story 3.1 will implement DrillDetail sheet component
- onClick will trigger sheet open with full drill information

**Future Enhancements (Not in MVP):**
- Compact variant (240px, 120px thumbnail)
- Relevance chip for semantic search results
- Image load error fallback
- Skeleton variant for loading states
- Favorite/bookmark indicator

### Design System Reference

**Colors:**
- Hockey Blue: #1e3a5f (primary brand, titles, borders)
- Ice Blue: #38bdf8 (accent, hover states, CTAs)
- Rink Gray: gray-600 (secondary text, author)
- Glacier White: white (backgrounds, icons on dark)

**Source-Specific Colors (for SourceBadge - Story 2.4):**
- YouTube: red-600
- Reddit: orange-500
- Instagram: pink-500
- TikTok: black (with cyan accent)

**Difficulty Colors (for DifficultyBadge - Story 2.4):**
- Beginner: green-500
- Intermediate: amber-500
- Advanced: red-500

**Typography:**
- Title: Inter Semibold 18px (text-base font-semibold)
- Author: Inter Regular 14px (text-sm)
- Badges: Inter Regular 12px (text-xs)

**Spacing:**
- Card padding: p-4 (16px all sides)
- Element gaps: gap-2 (8px between badges)
- Grid gap: gap-6 (24px between cards)

### Previous Story Patterns to Maintain

**From Story 2.1 (Library Page):**
- Named exports only
- @/ imports exclusively
- Component props interfaces exported separately
- TypeScript strict mode compliance
- Unit tests with Vitest + React Testing Library

**From Story 1.4 (API Integration):**
- ContentItem type with PascalCase enums and snake_case fields
- Backend contract integrity maintained

**From Story 1.3 (Router & Layout):**
- Semantic HTML structure
- Accessibility with ARIA attributes

**From Story 1.2 (Design System):**
- Tailwind custom theme colors
- shadcn/ui component patterns
- Responsive design utilities

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log

**2026-01-28 - Implementation**
- Created DrillCard component with comprehensive test coverage (22 tests, all passing)
- Implemented thumbnail display logic with conditional rendering for different sources
- Created Instagram placeholder (pink/purple gradient + white icon)
- Created TikTok placeholder (black background + cyan musical note icon)
- Implemented metadata display: title (2-line truncation), author, badges, tags
- Added hover effects: scale-[1.02], shadow-lg, border color transitions
- Created SourceBadge placeholder component with source-specific colors
- Created DifficultyBadge placeholder component with color-coding (green/amber/red)
- Fixed missing thumbnail_url field in ContentItem type
- Fixed difficulty enum values to PascalCase (Beginner/Intermediate/Advanced)
- Integrated DrillCard into Library.tsx, replacing local implementation
- Updated Library tests to match new DrillCard structure
- All tests passing: 30 passed, 1 skipped
- Production build successful: TypeScript strict mode clean

### Code Review Fixes

**2026-01-28 - Code Review by Dev Agent (Amelia)**
- **Accessibility (MEDIUM):** Fixed `DrillCard` not being keyboard accessible. Added `role="button"`, `tabIndex={0}`, and an `onKeyDown` handler to make the component focusable and interactive via keyboard. Updated tests to reflect this change.
- **Code Quality (LOW):** Refactored `DrillCard`, `SourceBadge`, and `DifficultyBadge` to use the project's standard `cn()` utility for consistent and safe class name handling.
- **Robustness (LOW):** Corrected brittle string matching in `DifficultyBadge`. Changed `includes()` to a strict `===` check for more reliable color-coding.

### Completion Notes List

✅ **Story 2.2 Implementation Complete**
- DrillCard component fully implemented per AC specifications
- All 8 tasks and 60+ subtasks completed
- 22 new unit tests added, all passing
- Component properly integrated with Library page from Story 2.1
- TypeScript strict mode compliance verified
- Production build successful

**Key Implementation Details:**
- Exported DrillCardProps interface separately (project-context.md pattern)
- Used @/ path alias throughout (no relative imports)
- Named exports only (no default exports)
- PascalCase enum values maintained (YouTube, Instagram, TikTok, Reddit)
- snake_case field names maintained (thumbnail_url, drill_tags, drill_description)
- Responsive 16:9 aspect ratio for all thumbnails and placeholders
- Progressive disclosure: limited to 2 tags displayed
- Accessibility: role="article" on card, proper alt text on images

**Placeholder Components Created (Story 2.4 will enhance):**
- SourceBadge: Basic Badge with source text and temporary colors
- DifficultyBadge: Basic Badge with difficulty text and color-coding

**Integration with Library.tsx:**
- Removed local DrillCard implementation
- Imported new DrillCard from @/components/drills/DrillCard
- Added onClick handler (placeholder for Story 3.1 DrillDetail sheet)
- Grid layout maintained: 1 col mobile, 2 col tablet, 3 col desktop

**Testing Coverage:**
- Component structure (3 tests)
- Thumbnail display (4 tests)
- Instagram placeholder (2 tests)
- TikTok placeholder (2 tests)
- Metadata display (7 tests)
- Layout and styling (4 tests)
- Total: 22 tests, all passing

### File List

**New Files Created:**
- `coaching-content-library-web/src/components/drills/DrillCard.tsx`
- `coaching-content-library-web/src/components/drills/__tests__/DrillCard.test.tsx`
- `coaching-content-library-web/src/components/drills/SourceBadge.tsx`
- `coaching-content-library-web/src/components/drills/DifficultyBadge.tsx`

**Files Modified:**
- `coaching-content-library-web/src/lib/types.ts` (added thumbnail_url field, fixed difficulty enum)
- `coaching-content-library-web/src/pages/Library.tsx` (integrated DrillCard component)
- `coaching-content-library-web/src/pages/__tests__/Library.test.tsx` (updated mock data and assertions)
## Change Log

- **2026-01-28**: Story 2.2 implementation completed by Dev Agent (Amelia)
  - Created DrillCard component with thumbnail display, Instagram/TikTok placeholders, metadata layout
  - Created SourceBadge and DifficultyBadge placeholder components (Story 2.4 will enhance)
  - Implemented 22 comprehensive unit tests, all passing
  - Integrated with Library.tsx from Story 2.1, replacing local implementation
  - Fixed missing thumbnail_url field in ContentItem type
  - Fixed difficulty enum to PascalCase (Beginner/Intermediate/Advanced)
  - All acceptance criteria met, TypeScript strict mode clean, production build successful
  - Story marked ready for code review
